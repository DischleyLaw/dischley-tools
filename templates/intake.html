{% extends "base.html" %}
{% block title %}Client Intake{% endblock %}
{% block content %}
<style>
  body {
    background: #f8f9fa;
  }
  .intake-card {
    background: #fff;
    border-radius: 1rem;
    box-shadow: 0 6px 32px rgba(0,0,0,0.07), 0 1.5px 6px rgba(0,0,0,0.03);
    max-width: 540px;
    margin: 3rem auto;
    padding: 2.5rem 2rem;
    border: 1px solid #eaeaea;
  }
  .intake-card h2 {
    font-weight: 600;
    color: #002147;
    font-size: 2rem;
    letter-spacing: -1px;
  }
  .form-label {
    color: #212529;
    font-weight: 500;
    font-size: 1.08rem;
    margin-bottom: 0.25rem;
  }
  .form-control, .form-select, textarea.form-control {
    font-size: 1.15rem;
    border-radius: 0.5rem;
    border: 1px solid #d1d5db;
    padding: 0.7rem 1rem;
    background: #f9fafb;
    min-height: 3rem;
  }
  .form-floating > .form-control, .form-floating > .form-select {
    background: #f9fafb;
    border-radius: 0.5rem;
  }
  .form-floating > label {
    color: #2a2a2a;
    font-size: 1rem;
    opacity: .85;
  }
  .btn-primary {
    background: #002147;
    border: none;
    border-radius: 0.5rem;
    font-size: 1.15rem;
    padding: 0.75rem 2rem;
    transition: background 0.2s;
  }
  .btn-primary:hover, .btn-primary:focus {
    background: #00112a;
  }
  textarea.form-control {
    min-height: 4rem;
  }
  .mb-3 {
    margin-bottom: 1.5rem !important;
  }
  @media (max-width: 600px) {
    .intake-card {
      padding: 1.25rem 0.5rem;
    }
  }
</style>
<div class="intake-card">
  <h2 class="mb-4">Client Intake Form</h2>
  {% if submitted %}
    <p style="color: green;"><strong>Form submitted successfully!</strong></p>
  {% endif %}
  <form method="POST" autocomplete="off">
    <div class="mb-3 form-floating">
      <select name="staff_member" class="form-select" id="staffMemberSelect" placeholder="Staff Member">
        <option value="">-- Select Staff Member --</option>
        <option value="Tatum Brownlee">Tatum Brownlee</option>
        <option value="Nicole Purvis">Nicole Purvis</option>
        <option value="Patrick O'Brien">Patrick O'Brien</option>
        <option value="David Dischley">David Dischley</option>
      </select>
      <label for="staffMemberSelect" class="form-label">Staff Member</label>
    </div>
    <div class="mb-3 form-floating">
      <select name="case_type" id="caseTypeDropdown" class="form-select" placeholder="Type of Case">
        <option value="">-- Select Case Type --</option>
        <option value="Criminal">Criminal</option>
        <option value="DUI">DUI</option>
        <option value="Traffic">Traffic</option>
        <option value="Protective Order">Protective Order</option>
        <option value="Expungement">Expungement</option>
        <option value="Probation Violation">Probation Violation</option>
        <option value="Civil">Civil</option>
      </select>
      <label for="caseTypeDropdown" class="form-label">Type of Case</label>
    </div>
    <div class="mb-3 form-floating">
      <input type="text" name="first_name" id="firstNameInput" required class="form-control" placeholder="First Name">
      <label for="firstNameInput" class="form-label">First Name</label>
    </div>
    <div class="mb-3 form-floating">
      <input type="text" name="last_name" id="lastNameInput" class="form-control" placeholder="Last Name">
      <label for="lastNameInput" class="form-label">Last Name</label>
    </div>
    <div class="mb-3 form-floating">
      <input type="tel" name="phone" id="phoneInput" class="form-control" placeholder="Phone Number">
      <label for="phoneInput" class="form-label">Phone Number</label>
    </div>
    <div class="mb-3 form-floating">
      <input type="email" name="email" id="emailInput" class="form-control" placeholder="Email">
      <label for="emailInput" class="form-label">Email</label>
    </div>
    <div class="mb-3 form-floating">
      <textarea name="charges" id="chargesInput" style="height: 100px;" class="form-control" placeholder="Charges"></textarea>
      <label for="chargesInput" class="form-label">Charges</label>
    </div>

    <div class="mb-3 form-floating">
      <select name="court" class="form-select" id="courtSelect" placeholder="Court">
        <option value="">-- Select Court --</option>
          <option value="Alexandria City Circuit Court">Alexandria City Circuit Court</option>
          <option value="Alexandria City General District Court">Alexandria City General District Court</option>
          <option value="Alexandria Juvenile and Domestic Relations District Court">Alexandria Juvenile and Domestic Relations District Court</option>
          <option value="Amherst General District Court">Amherst General District Court</option>
          <option value="Arlington County Circuit Court">Arlington County Circuit Court</option>
          <option value="Arlington County General District Court">Arlington County General District Court</option>
          <option value="Arlington County Juvenile and Domestic Relations Court">Arlington County Juvenile and Domestic Relations Court</option>
          <option value="Caroline County General District Court">Caroline County General District Court</option>
          <option value="Clarke County General District Court">Clarke County General District Court</option>
          <option value="Culpeper Circuit Court">Culpeper Circuit Court</option>
          <option value="Culpeper General District Court">Culpeper General District Court</option>
          <option value="Essex County General District Court">Essex County General District Court</option>
          <option value="Fairfax City General District Court">Fairfax City General District Court</option>
          <option value="Fairfax County Circuit Court">Fairfax County Circuit Court</option>
          <option value="Fairfax County General District Court">Fairfax County General District Court</option>
          <option value="Fairfax County Juvenile and Domestic Relations Court">Fairfax County Juvenile and Domestic Relations Court</option>
          <option value="Falls Church General District Court">Falls Church General District Court</option>
          <option value="Falls Church Juvenile and Domestic Relations Court">Falls Church Juvenile and Domestic Relations Court</option>
          <option value="Fauquier County Circuit Court">Fauquier County Circuit Court</option>
          <option value="Fauquier County General District Court">Fauquier County General District Court</option>
          <option value="Fauquier County Juvenile and Domestic Relations Court">Fauquier County Juvenile and Domestic Relations Court</option>
          <option value="Frederick County General District Court">Frederick County General District Court</option>
          <option value="Fredricksburg City General District Court">Fredricksburg City General District Court</option>
          <option value="Hanover General District Court">Hanover General District Court</option>
          <option value="Henrico County General District Court">Henrico County General District Court</option>
          <option value="King George County Circuit Court">King George County Circuit Court</option>
          <option value="King George County Juvenile and Domestic Relations Court">King George County Juvenile and Domestic Relations Court</option>
          <option value="King George General District Court">King George General District Court</option>
          <option value="King George Juvenile and Domestic Relations Court">King George Juvenile and Domestic Relations Court</option>
          <option value="Loudoun County Circuit Court">Loudoun County Circuit Court</option>
          <option value="Loudoun County General District Court">Loudoun County General District Court</option>
          <option value="Loudoun County Juvenile and Domestic Relations Court">Loudoun County Juvenile and Domestic Relations Court</option>
          <option value="Orange County General District Court">Orange County General District Court</option>
          <option value="Orange County Juvenile and Domestic Relations Court">Orange County Juvenile and Domestic Relations Court</option>
          <option value="Page County Circuit Court">Page County Circuit Court</option>
          <option value="Page County General District Court">Page County General District Court</option>
          <option value="Prince William County Circuit Court">Prince William County Circuit Court</option>
          <option value="Prince William County General District Court">Prince William County General District Court</option>
          <option value="Prince William County Juvenile and Domestic Relations Court">Prince William County Juvenile and Domestic Relations Court</option>
          <option value="Rappahannock Circuit Court">Rappahannock Circuit Court</option>
          <option value="Rappahannock General District Court">Rappahannock General District Court</option>
          <option value="Rappahannock Juvenile and Domestic Relations Court">Rappahannock Juvenile and Domestic Relations Court</option>
          <option value="Rockbridge County General District Court">Rockbridge County General District Court</option>
          <option value="Rockingham County General District Court">Rockingham County General District Court</option>
          <option value="Shenandoah County Circuit Court">Shenandoah County Circuit Court</option>
          <option value="Shenandoah General District Court">Shenandoah General District Court</option>
          <option value="Spotsylvania Circuit Court">Spotsylvania Circuit Court</option>
          <option value="Spotsylvania General District Court">Spotsylvania General District Court</option>
          <option value="Spotsylvania Juvenile and Domestic Relations District Court">Spotsylvania Juvenile and Domestic Relations District Court</option>
          <option value="Stafford County Circuit Court">Stafford County Circuit Court</option>
          <option value="Stafford County General District Court">Stafford County General District Court</option>
          <option value="Stafford Juvenile and Domestic Relations Court">Stafford Juvenile and Domestic Relations Court</option>
          <option value="TBD">TBD</option>
          <option value="Town of Herndon General District Court">Town of Herndon General District Court</option>
          <option value="Town of Vienna General District Court">Town of Vienna General District Court</option>
          <option value="United States District Court - District of Columbia">United States District Court - District of Columbia</option>
          <option value="United States District Court - Eastern District of Virginia">United States District Court - Eastern District of Virginia</option>
          <option value="United States District Court - Western District of Virginia">United States District Court - Western District of Virginia</option>
          <option value="United States District Court for the District of Nevada">United States District Court for the District of Nevada</option>
          <option value="Warren County Circuit Court">Warren County Circuit Court</option>
          <option value="Warren County General District Court">Warren County General District Court</option>
          <option value="Warren County Juvenile and Domestic Relations Court">Warren County Juvenile and Domestic Relations Court</option>
          <option value="Winchester General District Court">Winchester General District Court</option>
      </select>
      <label for="courtSelect" class="form-label">Court</label>
    </div>
    <div class="mb-3 row g-2">
      <div class="col-12 col-md-6 form-floating mb-3 mb-md-0">
        <input type="date" name="court_date" id="courtDateInput" class="form-control" placeholder="Court Date">
        <label for="courtDateInput" class="form-label">Court Date</label>
        <input type="hidden" name="court_date_formatted" id="courtDateFormatted">
      </div>
      <div class="col-12 col-md-6 form-floating">
        <input type="time" name="court_time" id="courtTimeInput" class="form-control" placeholder="Court Time">
        <label for="courtTimeInput" class="form-label">Court Time</label>
      </div>
    </div>
    <div class="mb-3 form-floating">
      <textarea name="facts" id="factsInput" style="height: 100px;" class="form-control" placeholder="Facts"></textarea>
      <label for="factsInput" class="form-label">Facts</label>
    </div>
    <div class="mb-3 form-floating">
      <textarea name="notes" id="notesInput" style="height: 100px;" class="form-control" placeholder="Notes"></textarea>
      <label for="notesInput" class="form-label">Notes</label>
    </div>
    <div class="mb-3 form-floating">
      <textarea name="homework" id="homeworkInput" style="height: 100px;" class="form-control" placeholder="Homework"></textarea>
      <label for="homeworkInput" class="form-label">Homework</label>
    </div>

    <div class="mb-3 form-floating">
      <select name="lead_source" id="leadSourceDropdown" onchange="toggleOtherSourceInput()" class="form-select" placeholder="Lead Source">
        <option value="">-- Select Source --</option>
        <option value="Avvo">Avvo</option>
        <option value="Facebook">Facebook</option>
        <option value="Google Ad">Google Ad</option>
        <option value="Justia">Justia</option>
        <option value="LinkedIn">LinkedIn</option>
        <option value="Martindale">Martindale</option>
        <option value="Previous Client">Previous Client</option>
        <option value="Referral">Referral</option>
        <option value="Referred by a Previous Client">Referred by a Previous Client</option>
        <option value="SuperLawyers">SuperLawyers</option>
        <option value="Twitter">Twitter</option>
        <option value="Unknown">Unknown</option>
        <option value="Website">Website</option>
        <option value="Yelp">Yelp</option>
        <option value="Other">Other</option>
      </select>
      <label for="leadSourceDropdown" class="form-label">Lead Source</label>
    </div>
    <div id="otherSourceInput" style="display: none;" class="mb-3 form-floating">
      <input type="text" name="lead_source_other" id="leadSourceOtherInput" class="form-control" placeholder="Other Lead Source">
      <label for="leadSourceOtherInput" class="form-label">Other Lead Source</label>
    </div>

      <div id="duiFields" style="display: none;">
        <div class="mb-3">
          <div class="form-group">
            <label>Was Blood Taken?</label>
            <select name="dui_blood_taken" class="form-control">
              <option value="">-- Select --</option>
              <option value="Yes">Yes</option>
              <option value="No">No</option>
            </select>
          </div>
        </div>
        <div class="mb-3">
          <div class="form-group">
            <label>Refusal Charge?</label>
            <select name="dui_refusal" class="form-control">
              <option value="">-- Select --</option>
              <option value="Yes">Yes</option>
              <option value="No">No</option>
            </select>
          </div>
        </div>
        <div class="mb-3">
          <div class="form-group">
            <label>Prior Offenses?</label>
            <input type="number" name="dui_prior_offenses" min="0" class="form-control">
          </div>
        </div>
        <div class="mb-3">
          <div class="form-group">
            <label>Interlock Required?</label>
            <select name="dui_interlock" class="form-control">
              <option value="">-- Select --</option>
              <option value="Yes">Yes</option>
              <option value="No">No</option>
            </select>
          </div>
        </div>
      </div>
      <div id="protectiveFields" style="display: none;">
        <div class="mb-3">
          <div class="form-group">
            <label>Petitioner Name:</label>
            <input type="text" name="po_petitioner" class="form-control">
          </div>
        </div>
        <div class="mb-3">
          <div class="form-group">
            <label>Relationship:</label>
            <input type="text" name="po_relationship" class="form-control">
          </div>
        </div>
        <div class="mb-3">
          <div class="form-group">
            <label>Type of Order:</label>
            <select name="po_order_type" class="form-control">
              <option value="">-- Select --</option>
              <option value="Emergency">Emergency</option>
              <option value="Preliminary">Preliminary</option>
              <option value="Permanent">Permanent</option>
            </select>
          </div>
        </div>
      </div>
      <div id="expungementFields" style="display: none;">
        <div class="mb-3">
          <div class="form-group">
            <label>Original Charge:</label>
            <input type="text" name="exp_original_charge" class="form-control">
          </div>
        </div>
        <div class="mb-3">
          <div class="form-group">
            <label>Disposition:</label>
            <input type="text" name="exp_disposition" class="form-control">
          </div>
        </div>
        <div class="mb-3">
          <div class="form-group">
            <label>Basis for Expungement:</label>
            <input type="text" name="exp_basis" class="form-control">
          </div>
        </div>
      </div>
      <div id="civilFields" style="display: none;">
        <div class="mb-3">
          <div class="form-group">
            <label>Opposing Party:</label>
            <input type="text" name="civil_opposing_party" class="form-control">
          </div>
        </div>
        <div class="mb-3">
          <div class="form-group">
            <label>Nature of Dispute:</label>
            <textarea name="civil_dispute" rows="2" class="form-control"></textarea>
          </div>
        </div>
        <div class="mb-3">
          <div class="form-group">
            <label>Amount in Controversy:</label>
            <input type="text" name="civil_amount" class="form-control">
          </div>
        </div>
      </div>

    <div id="duiFields" style="display: none;">
      <div class="mb-3 form-floating">
        <select name="dui_blood_taken" id="duiBloodTaken" class="form-select" placeholder="Was Blood Taken?">
          <option value="">-- Select --</option>
          <option value="Yes">Yes</option>
          <option value="No">No</option>
        </select>
        <label for="duiBloodTaken" class="form-label">Was Blood Taken?</label>
      </div>
      <div class="mb-3 form-floating">
        <select name="dui_refusal" id="duiRefusal" class="form-select" placeholder="Refusal Charge?">
          <option value="">-- Select --</option>
          <option value="Yes">Yes</option>
          <option value="No">No</option>
        </select>
        <label for="duiRefusal" class="form-label">Refusal Charge?</label>
      </div>
      <div class="mb-3 form-floating">
        <input type="number" name="dui_prior_offenses" id="duiPrior" min="0" class="form-control" placeholder="Prior Offenses?">
        <label for="duiPrior" class="form-label">Prior Offenses?</label>
      </div>
      <div class="mb-3 form-floating">
        <select name="dui_interlock" id="duiInterlock" class="form-select" placeholder="Interlock Required?">
          <option value="">-- Select --</option>
          <option value="Yes">Yes</option>
          <option value="No">No</option>
        </select>
        <label for="duiInterlock" class="form-label">Interlock Required?</label>
      </div>
    </div>
    <div id="protectiveFields" style="display: none;">
      <div class="mb-3 form-floating">
        <input type="text" name="po_petitioner" id="poPetitioner" class="form-control" placeholder="Petitioner Name">
        <label for="poPetitioner" class="form-label">Petitioner Name</label>
      </div>
      <div class="mb-3 form-floating">
        <input type="text" name="po_relationship" id="poRelationship" class="form-control" placeholder="Relationship">
        <label for="poRelationship" class="form-label">Relationship</label>
      </div>
      <div class="mb-3 form-floating">
        <select name="po_order_type" id="poOrderType" class="form-select" placeholder="Type of Order">
          <option value="">-- Select --</option>
          <option value="Emergency">Emergency</option>
          <option value="Preliminary">Preliminary</option>
          <option value="Permanent">Permanent</option>
        </select>
        <label for="poOrderType" class="form-label">Type of Order</label>
      </div>
    </div>
    <div id="expungementFields" style="display: none;">
      <div class="mb-3 form-floating">
        <input type="text" name="exp_original_charge" id="expOriginalCharge" class="form-control" placeholder="Original Charge">
        <label for="expOriginalCharge" class="form-label">Original Charge</label>
      </div>
      <div class="mb-3 form-floating">
        <input type="text" name="exp_disposition" id="expDisposition" class="form-control" placeholder="Disposition">
        <label for="expDisposition" class="form-label">Disposition</label>
      </div>
      <div class="mb-3 form-floating">
        <input type="text" name="exp_basis" id="expBasis" class="form-control" placeholder="Basis for Expungement">
        <label for="expBasis" class="form-label">Basis for Expungement</label>
      </div>
    </div>
    <div id="civilFields" style="display: none;">
      <div class="mb-3 form-floating">
        <input type="text" name="civil_opposing_party" id="civilOpposingParty" class="form-control" placeholder="Opposing Party">
        <label for="civilOpposingParty" class="form-label">Opposing Party</label>
      </div>
      <div class="mb-3 form-floating">
        <textarea name="civil_dispute" id="civilDispute" style="height: 70px;" class="form-control" placeholder="Nature of Dispute"></textarea>
        <label for="civilDispute" class="form-label">Nature of Dispute</label>
      </div>
      <div class="mb-3 form-floating">
        <input type="text" name="civil_amount" id="civilAmount" class="form-control" placeholder="Amount in Controversy">
        <label for="civilAmount" class="form-label">Amount in Controversy</label>
      </div>
    </div>
    <button type="submit" class="btn btn-primary w-100 mt-3">Submit</button>
  </form>
</div>
{% endblock %}
<script>
  function toggleOtherSourceInput() {
    const dropdown = document.getElementById("leadSourceDropdown");
    const otherInput = document.getElementById("otherSourceInput");
    otherInput.style.display = dropdown.value === "Other" ? "block" : "none";
  }

  document.addEventListener("DOMContentLoaded", function () {
    const dropdown = document.getElementById("caseTypeDropdown");
    const dui = document.getElementById("duiFields");
    const po = document.getElementById("protectiveFields");
    const exp = document.getElementById("expungementFields");
    const civ = document.getElementById("civilFields");

    function toggleFields() {
      dui.style.display = "none";
      po.style.display = "none";
      exp.style.display = "none";
      civ.style.display = "none";

      switch (dropdown.value) {
        case "DUI": dui.style.display = "block"; break;
        case "Protective Order": po.style.display = "block"; break;
        case "Expungement": exp.style.display = "block"; break;
        case "Civil": civ.style.display = "block"; break;
      }
    }

    dropdown.addEventListener("change", toggleFields);
    toggleFields(); // Call once on page load

    // Ensure Other Lead Source is visible if "Other" is selected on reload
    toggleOtherSourceInput();
    document.getElementById("leadSourceDropdown").addEventListener("change", toggleOtherSourceInput);

    // Format court date as "Month Day, Year" to hidden input
    const courtDateInput = document.getElementById("courtDateInput");
    const courtDateFormatted = document.getElementById("courtDateFormatted");
    function updateFormattedCourtDate() {
      if (courtDateInput.value) {
        const dateObj = new Date(courtDateInput.value);
        if (!isNaN(dateObj)) {
          const options = { year: "numeric", month: "long", day: "numeric" };
          courtDateFormatted.value = dateObj.toLocaleDateString("en-US", options);
        } else {
          courtDateFormatted.value = "";
        }
      } else {
        courtDateFormatted.value = "";
      }
    }
    courtDateInput.addEventListener("change", updateFormattedCourtDate);
    updateFormattedCourtDate();
    // Also update before submit in case of browser autofill
    courtDateInput.form && courtDateInput.form.addEventListener("submit", updateFormattedCourtDate);
  });
</script>