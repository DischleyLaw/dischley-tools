{% extends "base.html" %}
{% block title %}Submit Case Result{% endblock %}
{% block content %}
<div class="card">
  <div class="card-body">
    <h2 class="mb-4">Submit Case Result</h2>
    <form method="POST">
      <label>Court:</label><br>
      <select name="court" id="court_select" onchange="toggleCourtInput()">
        <option value="">-- Select Court --</option>
        <option value="Alexandria City Circuit Court">Alexandria City Circuit Court</option>
        <option value="Alexandria City General District Court">Alexandria City General District Court</option>
        <option value="Alexandria Juvenile and Domestic Relations District Court">Alexandria Juvenile and Domestic Relations District Court</option>
        <option value="Amherst General District Court">Amherst General District Court</option>
        <option value="Arlington County Circuit Court">Arlington County Circuit Court</option>
        <option value="Arlington County General District Court">Arlington County General District Court</option>
        <option value="Arlington County Juvenile and Domestic Relations Court">Arlington County Juvenile and Domestic Relations Court</option>
        <option value="Caroline County General District Court">Caroline County General District Court</option>
        <option value="Clarke County General District Court">Clarke County General District Court</option>
        <option value="Culpeper Circuit Court">Culpeper Circuit Court</option>
        <option value="Culpeper General District Court">Culpeper General District Court</option>
        <option value="Essex County General District Court">Essex County General District Court</option>
        <option value="Fairfax City General District Court">Fairfax City General District Court</option>
        <option value="Fairfax County Circuit Court">Fairfax County Circuit Court</option>
        <option value="Fairfax County General District Court">Fairfax County General District Court</option>
        <option value="Fairfax County Juvenile and Domestic Relations Court">Fairfax County Juvenile and Domestic Relations Court</option>
        <option value="Falls Church General District Court">Falls Church General District Court</option>
        <option value="Falls Church Juvenile and Domestic Relations Court">Falls Church Juvenile and Domestic Relations Court</option>
        <option value="Fauquier County Circuit Court">Fauquier County Circuit Court</option>
        <option value="Fauquier County General District Court">Fauquier County General District Court</option>
        <option value="Fauquier County Juvenile and Domestic Relations Court">Fauquier County Juvenile and Domestic Relations Court</option>
        <option value="Frederick County General District Court">Frederick County General District Court</option>
        <option value="Fredricksburg City General District Court">Fredricksburg City General District Court</option>
        <option value="Hanover General District Court">Hanover General District Court</option>
        <option value="Henrico County General District Court">Henrico County General District Court</option>
        <option value="King George County Circuit Court">King George County Circuit Court</option>
        <option value="King George County Juvenile and Domestic Relations Court">King George County Juvenile and Domestic Relations Court</option>
        <option value="King George General District Court">King George General District Court</option>
        <option value="King George Juvenile and Domestic Relations Court">King George Juvenile and Domestic Relations Court</option>
        <option value="Loudoun County Circuit Court">Loudoun County Circuit Court</option>
        <option value="Loudoun County General District Court">Loudoun County General District Court</option>
        <option value="Loudoun County Juvenile and Domestic Relations Court">Loudoun County Juvenile and Domestic Relations Court</option>
        <option value="Orange County General District Court">Orange County General District Court</option>
        <option value="Orange County Juvenile and Domestic Relations Court">Orange County Juvenile and Domestic Relations Court</option>
        <option value="Page County Circuit Court">Page County Circuit Court</option>
        <option value="Page County General District Court">Page County General District Court</option>
        <option value="Prince William County Circuit Court">Prince William County Circuit Court</option>
        <option value="Prince William County General District Court">Prince William County General District Court</option>
        <option value="Prince William County Juvenile and Domestic Relations Court">Prince William County Juvenile and Domestic Relations Court</option>
        <option value="Rappahannock Circuit Court">Rappahannock Circuit Court</option>
        <option value="Rappahannock General District Court">Rappahannock General District Court</option>
        <option value="Rappahannock Juvenile and Domestic Relations Court">Rappahannock Juvenile and Domestic Relations Court</option>
        <option value="Rockbridge County General District Court">Rockbridge County General District Court</option>
        <option value="Rockingham County General District Court">Rockingham County General District Court</option>
        <option value="Shenandoah County Circuit Court">Shenandoah County Circuit Court</option>
        <option value="Shenandoah General District Court">Shenandoah General District Court</option>
        <option value="Spotsylvania Circuit Court">Spotsylvania Circuit Court</option>
        <option value="Spotsylvania General District Court">Spotsylvania General District Court</option>
        <option value="Spotsylvania Juvenile and Domestic Relations District Court">Spotsylvania Juvenile and Domestic Relations District Court</option>
        <option value="Stafford County Circuit Court">Stafford County Circuit Court</option>
        <option value="Stafford County General District Court">Stafford County General District Court</option>
        <option value="Stafford Juvenile and Domestic Relations Court">Stafford Juvenile and Domestic Relations Court</option>
        <option value="Town of Herndon General District Court">Town of Herndon General District Court</option>
        <option value="Town of Vienna General District Court">Town of Vienna General District Court</option>
        <option value="United States District Court - District of Columbia">United States District Court - District of Columbia</option>
        <option value="United States District Court - Eastern District of Virginia">United States District Court - Eastern District of Virginia</option>
        <option value="United States District Court - Western District of Virginia">United States District Court - Western District of Virginia</option>
        <option value="United States District Court for the District of Nevada">United States District Court for the District of Nevada</option>
        <option value="Warren County Circuit Court">Warren County Circuit Court</option>
        <option value="Warren County General District Court">Warren County General District Court</option>
        <option value="Warren County Juvenile and Domestic Relations Court">Warren County Juvenile and Domestic Relations Court</option>
        <option value="Winchester General District Court">Winchester General District Court</option>
        <option value="Other">Other</option>
      </select><br><br>
      <div id="custom_court_container" style="display: none;">
        <label>Enter Court:</label><br>
        <input type="text" name="custom_court"><br><br>
      </div>

      <label>Client Name:</label><br>
      <input type="text" name="defendant_name"><br><br>

      <label>Original Charge:</label><br>
      <input type="text" name="offense"><br><br>

      <label>Amended Charge:</label><br>
      <input type="text" name="amended_charge"><br><br>

      <label>Disposition:</label><br>
      <select name="disposition" id="disposition" onchange="toggleOtherDisposition()">
        <option value="Not Guilty">Not Guilty</option>
        <option value="Guilty">Guilty</option>
        <option value="Dismissed">Dismissed</option>
        <option value="Dismissed with Costs">Dismissed with Costs</option>
        <option value="Taken Under Advisement for Dismissal">Taken Under Advisement for Dismissal</option>
        <option value="Deferred Disposition">Deferred Disposition</option>
        <option value="Continued">Continued</option>
        <option value="Other">Other</option>
      </select><br><br>
      <div id="other_disposition_container" style="display: none;">
        <label>Specify Other Disposition:</label><br>
        <input type="text" name="other_disposition"><br><br>
      </div>

      <label>Jail Sentence:</label><br>
      <input type="text" name="jail_time_imposed" placeholder="e.g., 90"> days in jail with 
      <input type="text" name="jail_time_suspended" placeholder="e.g., 90"> days suspended<br><br>

      <label>Fine:</label><br>
      $<input type="text" name="fine_imposed" placeholder="e.g., 1000"> fine with 
      $<input type="text" name="fine_suspended" placeholder="e.g., 500"> suspended<br><br>

      <label>License Suspension:</label><br>
      <input type="text" name="license_suspension"><br><br>

      <label>Restricted License:</label><br>
      <select name="restricted_license">
        <option value="">-- Select --</option>
        <option value="No">No</option>
        <option value="Yes - Interlock Only">Yes - Interlock Only</option>
        <option value="Yes - Time and Place Restrictions Only">Yes - Time and Place Restrictions Only</option>
        <option value="Yes - Interlock and Time and Place Restrictions">Yes - Interlock and Time and Place Restrictions</option>
      </select><br><br>

      <label>VASAP Ordered:</label><br>
      <select name="asap_ordered">
        <option value="No" selected>No</option>
        <option value="Yes">Yes</option>
      </select><br><br>

      <label>Probation Type:</label><br>
      <select name="probation_type">
        <option value="">-- Select --</option>
        <option value="Supervised">Supervised</option>
        <option value="Unsupervised (GGB)">Unsupervised (GGB)</option>
      </select><br><br>

      <fieldset>
        <legend>Other Conditions:</legend>
        <label><input type="checkbox" name="conditions" value="VASAP"> VASAP</label><br>
        <label><input type="checkbox" name="conditions" value="VIP"> Victim Impact Panel (VIP)</label><br>
        <label><input type="checkbox" name="conditions" value="Community Service"> Community Service</label><br>
        <label><input type="checkbox" name="conditions" value="Anger Management"> Anger Management</label><br>
      </fieldset><br>

      <label>Was the case continued?</label><br>
      <select name="was_continued" id="was_continued" onchange="toggleContinuationDate()">
        <option value="No">No</option>
        <option value="Yes">Yes</option>
      </select><br><br>

      <div id="continuation_date_container" style="display: none;">
        <label>Continuation Date:</label><br>
        <input type="date" name="continuation_date">
        <input type="time" name="continuation_time"><br><br>
      </div>

      <input type="hidden" name="date_disposition" id="date_disposition">

      <label>Client Email:</label><br>
      <input type="email" name="client_email"><br><br>

      <label>Notes:</label><br>
      <textarea name="notes" rows="4" cols="50"></textarea><br><br>

      <label><input type="checkbox" name="send_review_links" value="true"> Send Review Links</label><br><br>

      <div id="additional_charges_container"></div>
      <button type="button" onclick="addAdditionalCharge()">Add Additional Charge</button><br><br>

      <div class="form-group">
        <input type="submit" value="Submit" class="btn btn-primary">
        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">Back to Dashboard</a>
        <a href="{{ url_for('dashboard') }}" class="btn btn-danger">Cancel</a>
      </div>
    </form>
  </div>
</div>
  <script>
    function toggleContinuationDate() {
      const disposition = document.getElementById("disposition").value;
      const wasContinued = document.getElementById("was_continued").value;
      const container = document.getElementById("continuation_date_container");

      if (disposition === "Continued" || wasContinued === "Yes") {
        container.style.display = "block";
      } else {
        container.style.display = "none";
      }
    }

    // Ensure the toggle runs on page load if "Continued" is pre-selected
    window.onload = function () {
      toggleContinuationDate();
    };

    let additionalChargeIndex = 0;

    function addAdditionalCharge() {
      const container = document.getElementById("additional_charges_container");
      const div = document.createElement("div");
      div.classList.add("additional-charge-group");
      div.innerHTML = `
        <hr>
        <h4>Additional Charge</h4>
        <label>Original Charge:</label><br>
        <input type="text" name="additional_charges[${additionalChargeIndex}][original_charge]"><br><br>

        <label>Final Amended Charge:</label><br>
        <input type="text" name="additional_charges[${additionalChargeIndex}][amended_charge]"><br><br>

        <label>Final Disposition:</label><br>
        <select name="additional_charges[${additionalChargeIndex}][disposition]">
          <option value="Not Guilty">Not Guilty</option>
          <option value="Guilty">Guilty</option>
          <option value="Dismissed">Dismissed</option>
          <option value="Dismissed with Costs">Dismissed with Costs</option>
          <option value="Taken Under Advisement for Dismissal">Taken Under Advisement for Dismissal</option>
          <option value="Deferred Disposition">Deferred Disposition</option>
          <option value="Continued">Continued</option>
          <option value="Other">Other</option>
        </select><br><br>

        <label>Other Disposition Notes:</label><br>
        <input type="text" name="additional_charges[${additionalChargeIndex}][other_disposition]"><br><br>

        <label>Jail Sentence:</label><br>
        <input type="text" name="additional_charges[${additionalChargeIndex}][jail_time_imposed]"> days in jail with 
        <input type="text" name="additional_charges[${additionalChargeIndex}][jail_time_suspended]"> days suspended<br><br>

        <label>Fine:</label><br>
        $<input type="text" name="additional_charges[${additionalChargeIndex}][fine_imposed]"> fine with 
        $<input type="text" name="additional_charges[${additionalChargeIndex}][fine_suspended]"> suspended<br><br>

        <label>License Suspension:</label><br>
        <input type="text" name="additional_charges[${additionalChargeIndex}][license_suspension]"><br><br>

        <label>Restricted License:</label><br>
        <select name="additional_charges[${additionalChargeIndex}][restricted_license]">
          <option value="">-- Select --</option>
          <option value="No">No</option>
          <option value="Yes - Interlock Only">Yes - Interlock Only</option>
          <option value="Yes - Time and Place Restrictions Only">Yes - Time and Place Restrictions Only</option>
          <option value="Yes - Interlock and Time and Place Restrictions">Yes - Interlock and Time and Place Restrictions</option>
        </select><br><br>

        <label>VASAP Ordered:</label><br>
        <select name="additional_charges[${additionalChargeIndex}][asap_ordered]">
          <option value="No" selected>No</option>
          <option value="Yes">Yes</option>
        </select><br><br>

        <label>Probation Type:</label><br>
        <select name="additional_charges[${additionalChargeIndex}][probation_type]">
          <option value="">-- Select --</option>
          <option value="Supervised">Supervised</option>
          <option value="Unsupervised (GGB)">Unsupervised (GGB)</option>
        </select><br><br>
      `;
      container.appendChild(div);
      additionalChargeIndex++;
    }
  </script>
{% endblock %}